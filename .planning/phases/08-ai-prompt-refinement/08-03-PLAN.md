---
phase: 08-ai-prompt-refinement
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(admin)/admin/settings/ai-prompts-settings.tsx
  - src/app/(admin)/admin/settings/page.tsx
  - src/lib/ai/prompts.ts
autonomous: true
gap_closure: false

must_haves:
  truths:
    - "When no custom prompt has been saved, the AI Prompts settings textareas show the default prompt text (not blank)"
    - "The default text appears as the actual value in the textarea, not just placeholder text, so the admin can see exactly what the AI is using"
    - "If an admin modifies and saves a custom prompt, that custom text appears on subsequent loads"
    - "The default prompts are exported from prompts.ts and imported by the settings page to stay DRY"
  artifacts:
    - path: "src/lib/ai/prompts.ts"
      provides: "Exported DEFAULT_ANALYSIS_PROMPT, DEFAULT_ARTICLE_STYLE_PROMPT, DEFAULT_FILE_SUMMARY_PROMPT constants"
    - path: "src/app/(admin)/admin/settings/ai-prompts-settings.tsx"
      provides: "Textareas pre-filled with default prompts when no custom value is saved"
  key_links:
    - from: "src/app/(admin)/admin/settings/ai-prompts-settings.tsx"
      to: "src/lib/ai/prompts.ts"
      via: "import default prompt constants for fallback display"
      pattern: "DEFAULT_ANALYSIS_PROMPT"
---

<objective>
Show the default AI prompt text in the admin settings textareas when no custom prompt has been configured. Currently the fields are blank, which gives no visibility into what the AI is actually using.

Purpose: Admin can see and understand the current prompts without reading source code. If they want to customize, they start from the working default rather than a blank field.
Output: Textareas pre-filled with defaults, exported prompt constants from prompts.ts.
</objective>

<execution_context>
@/Users/michael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@src/lib/ai/prompts.ts
@src/app/(admin)/admin/settings/ai-prompts-settings.tsx
@src/app/(admin)/admin/settings/page.tsx
@src/app/(admin)/admin/settings/actions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Export default prompts and pre-fill settings textareas</name>
  <files>src/lib/ai/prompts.ts, src/app/(admin)/admin/settings/ai-prompts-settings.tsx</files>
  <action>
**1. Export the default prompt constants from src/lib/ai/prompts.ts:**

The three default constants are currently module-private (`const`). Export them so the settings UI can import them:

```ts
export const DEFAULT_ANALYSIS_PROMPT = `...`;
export const DEFAULT_ARTICLE_STYLE_PROMPT = `...`;
export const DEFAULT_FILE_SUMMARY_PROMPT = `...`;
```

Just add `export` to the existing declarations. No content changes.

**2. Update src/app/(admin)/admin/settings/ai-prompts-settings.tsx:**

Import the defaults:
```ts
import {
  DEFAULT_ANALYSIS_PROMPT,
  DEFAULT_ARTICLE_STYLE_PROMPT,
  DEFAULT_FILE_SUMMARY_PROMPT,
} from "@/lib/ai/prompts";
```

Update each textarea's `defaultValue` to fall back to the default prompt when the saved value is empty:

```tsx
// Analysis prompt
defaultValue={settings.analysis_prompt?.value || DEFAULT_ANALYSIS_PROMPT}

// Article style prompt
defaultValue={settings.article_style_prompt?.value || DEFAULT_ARTICLE_STYLE_PROMPT}

// File summary prompt
defaultValue={settings.file_summary_prompt?.value || DEFAULT_FILE_SUMMARY_PROMPT}
```

The `||` (not `??`) is intentional — an empty string `""` should also fall back to the default.

Also increase the `rows` on analysis_prompt and article_style_prompt from 6 to 12, since the default prompts are longer than 6 rows and the admin should be able to see the full text without excessive scrolling.

Leave the Ask AI prompts (global and page-level) as-is for now — those don't have defaults yet (Phase 7 feature).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npm run build` to verify compilation. Read ai-prompts-settings.tsx to confirm the three textareas use the default prompt fallbacks. Read prompts.ts to confirm the constants are exported.
  </verify>
  <done>
AI Prompts settings textareas show the full default prompt text when no custom value is saved. Admin can see exactly what the AI uses, edit it, or save a customized version. Default prompt constants are exported from prompts.ts.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. DEFAULT_ANALYSIS_PROMPT, DEFAULT_ARTICLE_STYLE_PROMPT, DEFAULT_FILE_SUMMARY_PROMPT are exported from prompts.ts
4. analysis_prompt textarea shows DEFAULT_ANALYSIS_PROMPT when settings value is empty
5. article_style_prompt textarea shows DEFAULT_ARTICLE_STYLE_PROMPT when settings value is empty
6. file_summary_prompt textarea shows DEFAULT_FILE_SUMMARY_PROMPT when settings value is empty
7. Textareas have sufficient rows to display the default text
</verification>

<success_criteria>
Admin sees the default AI prompt text in the settings fields when no custom prompt has been saved. The prompts are editable and saving a custom version overrides the default on next load.
</success_criteria>

<output>
After completion, create `.planning/phases/08-ai-prompt-refinement/08-03-SUMMARY.md`
</output>

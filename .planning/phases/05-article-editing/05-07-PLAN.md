---
phase: 05-article-editing
plan: 07
type: execute
wave: 2
depends_on: ["05-06"]
files_modified:
  - src/components/wiki/version-history.tsx
  - src/components/wiki/version-preview.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can click any version history record to open a slide-out panel showing rendered formatted text"
    - "The slide-out shows the version's markdown rendered as formatted HTML (not raw markdown)"
    - "The slide-out includes version metadata (date, source badge, creator, change summary)"
    - "User can close the slide-out and return to version history without any restore action"
    - "The slide-out works independently of the selection system (compare/restore)"
  artifacts:
    - path: "src/components/wiki/version-preview.tsx"
      provides: "VersionPreview component rendering markdown in a Sheet slide-out"
    - path: "src/components/wiki/version-history.tsx"
      provides: "Updated version list with preview trigger (Eye icon button)"
  key_links:
    - from: "src/components/wiki/version-history.tsx"
      to: "src/components/wiki/version-preview.tsx"
      via: "renders VersionPreview with selected version data"
      pattern: "VersionPreview"
    - from: "src/components/wiki/version-preview.tsx"
      to: "Sheet"
      via: "shadcn Sheet component for slide-out panel"
      pattern: "Sheet"
---

<objective>
Add a version preview slide-out panel to the version history. Clicking an Eye button on any version card opens a Sheet (slide-out from right) showing the version's content rendered as formatted HTML.

Purpose: Users can preview what any version looked like without restoring it or comparing two versions. Quick visual check of historical content.
Output: New VersionPreview component using shadcn Sheet, integrated into version-history.tsx.
</objective>

<execution_context>
@/Users/michael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/wiki/version-history.tsx
@src/components/ui/sheet.tsx
@src/components/wiki/article-content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VersionPreview slide-out component and integrate into version history</name>
  <files>src/components/wiki/version-preview.tsx, src/components/wiki/version-history.tsx</files>
  <action>
**1. Create src/components/wiki/version-preview.tsx:**

A client component that renders a version's content in a shadcn Sheet (slide-out panel):

```tsx
"use client";

import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetDescription,
} from "@/components/ui/sheet";
```

Props:
```ts
interface VersionPreviewProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  version: {
    changeSource: string;
    changeSummary: string | null;
    creatorName: string | null;
    createdAt: string;
    contentMarkdown: string;
  } | null;
}
```

The component renders:
- A `<Sheet open={open} onOpenChange={onOpenChange}>` wrapping a `<SheetContent side="right" className="w-full sm:max-w-2xl overflow-y-auto">`
- SheetHeader with:
  - SheetTitle: "Version Preview"
  - SheetDescription: date + source badge + creator name + change summary (if any)
- Content area: The version's `contentMarkdown` rendered as formatted HTML
  - Use `react-markdown` with the same configuration as ArticleContent for consistent rendering. Import `Markdown` (or `MarkdownAsync` if RSC â€” but this is a client component so use the sync `Markdown` export) from `react-markdown`.
  - Wrap in `<div className="prose prose-zinc dark:prose-invert max-w-none">` for consistent styling with the article view.
  - Include rehype-raw and remark-gfm plugins for full GFM + HTML rendering, matching the article page's rendering pipeline.

If react-markdown's sync Markdown component is available in the version installed, use it. If only MarkdownAsync is available (react-markdown v10+), use it wrapped in a Suspense boundary. Check the existing article-content.tsx for the pattern used.

Reuse the `ChangeSourceBadge` from version-history.tsx. To avoid circular imports, either:
- Extract `ChangeSourceBadge` to a shared file (e.g., `src/components/wiki/change-source-badge.tsx`), OR
- Duplicate the minimal badge rendering in the preview (simpler for a small component)

The simpler approach is to move `ChangeSourceBadge` to its own file and import it in both places.

**2. Update src/components/wiki/version-history.tsx:**

a) **Add preview state:**
```ts
const [previewVersion, setPreviewVersion] = useState<Version | null>(null);
```

b) **Add Eye button to each version card:**
In the version card rendering, add an Eye icon button that opens the preview. Place it to the left of the selection circle. This is a separate interaction from the card click (which toggles selection).

```tsx
<button
  type="button"
  onClick={(e) => {
    e.stopPropagation(); // Don't toggle selection
    setPreviewVersion(version);
  }}
  className="shrink-0 p-1 rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors"
  title="Preview this version"
>
  <Eye className="size-4" />
</button>
```

Import `Eye` from lucide-react.

c) **Render VersionPreview at the bottom of the component:**
```tsx
<VersionPreview
  open={previewVersion !== null}
  onOpenChange={(open) => { if (!open) setPreviewVersion(null); }}
  version={previewVersion}
/>
```

Import VersionPreview from `./version-preview`.

d) **Extract ChangeSourceBadge** to `src/components/wiki/change-source-badge.tsx` and import it in both version-history.tsx and version-preview.tsx. The badge component stays identical, just lives in its own file.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npm run build` to verify compilation. Read version-history.tsx to confirm Eye button exists on each version card. Read version-preview.tsx to confirm Sheet renders with markdown content.
  </verify>
  <done>
Each version card in the History tab has an Eye icon button. Clicking it opens a slide-out Sheet panel from the right showing the version's content rendered as formatted markdown with metadata header. The slide-out can be closed without any restore action. Eye button does not interfere with the existing card-click selection system for compare/restore.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Eye button visible on each version card in version-history.tsx
4. VersionPreview component renders Sheet with markdown content
5. ChangeSourceBadge extracted to shared file and imported in both components
6. Clicking Eye does not toggle version selection (stopPropagation)
</verification>

<success_criteria>
User can click Eye icon on any version history record to view rendered formatted text in a slide-out panel. The preview shows full rendered markdown with version metadata. Closing the panel returns to normal history view with no side effects.
</success_criteria>

<output>
After completion, create `.planning/phases/05-article-editing/05-07-SUMMARY.md`
</output>
